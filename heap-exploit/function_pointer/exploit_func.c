#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <sys/types.h>

typedef struct data{
  char passwd[64];
} data_t;

typedef struct fp{
  int (*fp)();
} fp_t;

void allowed(){
  printf("Auth : success\n");
}

void denied(){
  printf("Auth : failed\n");
}

int main(int argc, char** argv){
  data_t *d;
  fp_t *f;

  d = malloc(sizeof(data_t));
  f = malloc(sizeof(fp_t));
  f->fp = denied;

  printf("data is at %p, fp is at %p\n", d, f);

  strcpy(d->passwd, argv[1]);

  // Perform some authentication
  if (0){ // Auth success
    f->fp = allowed;
  }

  f->fp();
}
